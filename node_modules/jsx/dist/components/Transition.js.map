{
  "version": 3,
  "sources": ["../../js/components/Transition.tsx"],
  "sourcesContent": ["import { watch } from \"~/jsx\";\nimport { createElementPosition } from \"~/utils\";\n\ntype TransitionProps = {\n  name?: string,\n  $if?: boolean,\n};\n\nexport default function Transition(props: TransitionProps, slots: JSX.Slots): JSX.Element {\n  const elem = slots.default[0];\n\n  if (slots.default.length !== 1 || !(elem instanceof HTMLElement)) {\n    console.warn(\"<Transition> must have a single element as children\");\n    return slots.default as unknown as JSX.Element;\n  }\n\n  const name = () => props.name || \"jsx\";\n\n  const enterActive = () => `${name()}-enter-active`;\n  const enterFrom = () => `${name()}-enter-from`;\n  const enterTo = () => `${name()}-enter-to`;\n\n  const leaveActive = () => `${name()}-leave-active`;\n  const leaveFrom = () => `${name()}-leave-from`;\n  const leaveTo = () => `${name()}-leave-to`;\n\n  function nextFrame() {\n    return new Promise(res => {\n      requestAnimationFrame(() => requestAnimationFrame(res));\n    });\n  }\n\n  const anchor = createElementPosition();\n\n  const oldDisplay = elem.style.display;\n  // Prevent side effects like http requests from img elements\n  if (!props.$if) {\n    elem.style.display = \"none\";\n  }\n  elem.addEventListener(\"mount\", () => {\n    if (anchor.isPositioned()) {\n      return;\n    }\n\n    anchor.setFromElement(elem);\n    if (!props.$if) {\n      elem.remove();\n      elem.style.display = oldDisplay;\n    }\n  }, { once: true });\n\n  watch(async () => {\n    if (elem.classList.length) {\n      if (!props.$if && (\n        elem.classList.contains(enterFrom()) ||\n        elem.classList.contains(enterActive()) ||\n        elem.classList.contains(enterTo())\n      )) {\n        await nextFrame();\n        removeClasses();\n        elem.remove();\n      }\n      else if (props.$if && (\n        elem.classList.contains(leaveFrom()) ||\n        elem.classList.contains(leaveTo()) ||\n        elem.classList.contains(leaveActive())\n      )) {\n        await nextFrame();\n        removeClasses();\n        elem.remove();\n      }\n    }\n\n    if (props.$if) {\n      if (elem.isConnected) { return }\n      elem.classList.add(enterFrom());\n      elem.classList.add(enterActive());\n\n      anchor.insertNode(elem);\n      await nextFrame();\n\n      elem.classList.remove(enterFrom());\n      elem.classList.add(enterTo());\n    }\n    else if (elem.isConnected) {\n      elem.classList.add(leaveFrom());\n      elem.classList.add(leaveActive());\n\n      await nextFrame();\n\n      elem.classList.remove(leaveFrom());\n      elem.classList.add(leaveTo());\n    }\n  });\n\n  function removeClasses() {\n    elem.classList.remove(enterActive());\n    elem.classList.remove(enterFrom());\n    elem.classList.remove(enterTo());\n\n    elem.classList.remove(leaveActive());\n    elem.classList.remove(leaveFrom());\n    elem.classList.remove(leaveTo());\n  }\n\n  elem.addEventListener(\"transitionend\", () => {\n    removeClasses();\n\n    if (!props.$if) {\n      elem.remove();\n    }\n  });\n\n  return elem;\n}\n"],
  "mappings": "AAAA,SAAS,aAAa;AACtB,SAAS,6BAA6B;AAOvB,SAAR,WAA4B,OAAwB,OAA+B;AACxF,QAAM,OAAO,MAAM,QAAQ,CAAC;AAE5B,MAAI,MAAM,QAAQ,WAAW,KAAK,EAAE,gBAAgB,cAAc;AAChE,YAAQ,KAAK,qDAAqD;AAClE,WAAO,MAAM;AAAA,EACf;AAEA,QAAM,OAAO,MAAM,MAAM,QAAQ;AAEjC,QAAM,cAAc,MAAM,GAAG,KAAK,CAAC;AACnC,QAAM,YAAY,MAAM,GAAG,KAAK,CAAC;AACjC,QAAM,UAAU,MAAM,GAAG,KAAK,CAAC;AAE/B,QAAM,cAAc,MAAM,GAAG,KAAK,CAAC;AACnC,QAAM,YAAY,MAAM,GAAG,KAAK,CAAC;AACjC,QAAM,UAAU,MAAM,GAAG,KAAK,CAAC;AAE/B,WAAS,YAAY;AACnB,WAAO,IAAI,QAAQ,SAAO;AACxB,4BAAsB,MAAM,sBAAsB,GAAG,CAAC;AAAA,IACxD,CAAC;AAAA,EACH;AAEA,QAAM,SAAS,sBAAsB;AAErC,QAAM,aAAa,KAAK,MAAM;AAE9B,MAAI,CAAC,MAAM,KAAK;AACd,SAAK,MAAM,UAAU;AAAA,EACvB;AACA,OAAK,iBAAiB,SAAS,MAAM;AACnC,QAAI,OAAO,aAAa,GAAG;AACzB;AAAA,IACF;AAEA,WAAO,eAAe,IAAI;AAC1B,QAAI,CAAC,MAAM,KAAK;AACd,WAAK,OAAO;AACZ,WAAK,MAAM,UAAU;AAAA,IACvB;AAAA,EACF,GAAG,EAAE,MAAM,KAAK,CAAC;AAEjB,QAAM,YAAY;AAChB,QAAI,KAAK,UAAU,QAAQ;AACzB,UAAI,CAAC,MAAM,QACT,KAAK,UAAU,SAAS,UAAU,CAAC,KACnC,KAAK,UAAU,SAAS,YAAY,CAAC,KACrC,KAAK,UAAU,SAAS,QAAQ,CAAC,IAChC;AACD,cAAM,UAAU;AAChB,sBAAc;AACd,aAAK,OAAO;AAAA,MACd,WACS,MAAM,QACb,KAAK,UAAU,SAAS,UAAU,CAAC,KACnC,KAAK,UAAU,SAAS,QAAQ,CAAC,KACjC,KAAK,UAAU,SAAS,YAAY,CAAC,IACpC;AACD,cAAM,UAAU;AAChB,sBAAc;AACd,aAAK,OAAO;AAAA,MACd;AAAA,IACF;AAEA,QAAI,MAAM,KAAK;AACb,UAAI,KAAK,aAAa;AAAE;AAAA,MAAO;AAC/B,WAAK,UAAU,IAAI,UAAU,CAAC;AAC9B,WAAK,UAAU,IAAI,YAAY,CAAC;AAEhC,aAAO,WAAW,IAAI;AACtB,YAAM,UAAU;AAEhB,WAAK,UAAU,OAAO,UAAU,CAAC;AACjC,WAAK,UAAU,IAAI,QAAQ,CAAC;AAAA,IAC9B,WACS,KAAK,aAAa;AACzB,WAAK,UAAU,IAAI,UAAU,CAAC;AAC9B,WAAK,UAAU,IAAI,YAAY,CAAC;AAEhC,YAAM,UAAU;AAEhB,WAAK,UAAU,OAAO,UAAU,CAAC;AACjC,WAAK,UAAU,IAAI,QAAQ,CAAC;AAAA,IAC9B;AAAA,EACF,CAAC;AAED,WAAS,gBAAgB;AACvB,SAAK,UAAU,OAAO,YAAY,CAAC;AACnC,SAAK,UAAU,OAAO,UAAU,CAAC;AACjC,SAAK,UAAU,OAAO,QAAQ,CAAC;AAE/B,SAAK,UAAU,OAAO,YAAY,CAAC;AACnC,SAAK,UAAU,OAAO,UAAU,CAAC;AACjC,SAAK,UAAU,OAAO,QAAQ,CAAC;AAAA,EACjC;AAEA,OAAK,iBAAiB,iBAAiB,MAAM;AAC3C,kBAAc;AAEd,QAAI,CAAC,MAAM,KAAK;AACd,WAAK,OAAO;AAAA,IACd;AAAA,EACF,CAAC;AAED,SAAO;AACT;",
  "names": []
}
